# Mana System Implementation Summary

## Что реализовано / What Was Implemented

### Система Маны (Mana System Library)

Создана гибкая библиотека для создания системы маны с использованием паттерна Builder:

**Основные компоненты:**
- `IManaData` - Интерфейс для работы с маной
- `ManaData` - Реализация с NBT сериализацией
- `ManaDataBuilder` - Конструктор для создания системы маны
- `ManaHelper` - Вспомогательные методы для удобной работы
- `ModAttachments` - Регистрация системы хранения данных
- `ManaEvents` - Обработка событий (регенерация, синхронизация)
- `PlayerManaProvider` - Провайдер для сохранения/загрузки данных

### Красивый Манабар (Beautiful Mana Bar)

Создан адаптивный манабар справа экрана:

**Характеристики:**
- ✅ Позиция справа экрана (10px от края)
- ✅ Адаптируется к любому разрешению экрана
- ✅ Показывает текущую/максимальную ману
- ✅ Настраиваемые цвета для разных типов магии
- ✅ Плавная визуализация с эффектами
- ✅ Тени для текста для лучшей читаемости
- ✅ Метка "Mana" над шкалой

### Дополнительные Возможности

**Тестовые инструменты:**
- Тестовый предмет (`ManaTestItem`) для демонстрации потребления маны
- Команды отладки: `/mana get|set|add|setmax`

**Сетевая синхронизация:**
- Автоматическая синхронизация между сервером и клиентом
- Синхронизация каждую секунду во время игры
- Синхронизация при входе на сервер
- Синхронизация после респауна

## Файлы

### Код (16 новых файлов)

```
src/main/java/com/example/examplemod/
├── mana/
│   ├── IManaData.java                 - Интерфейс системы маны
│   ├── ManaData.java                  - Реализация хранилища маны
│   ├── ManaDataBuilder.java           - Builder для создания системы
│   ├── ManaHelper.java                - Вспомогательные методы
│   ├── ModAttachments.java            - Регистрация data attachments
│   ├── PlayerManaProvider.java        - NBT сериализация
│   └── ManaEvents.java                - Обработка событий
├── network/
│   └── SyncManaDataPacket.java        - Пакет синхронизации
├── client/
│   └── ManaBarOverlay.java            - Рендер манабара
├── items/
│   └── ManaTestItem.java              - Тестовый предмет
├── commands/
│   └── ManaCommands.java              - Команды отладки
└── ExampleMod.java                    - Обновлен для регистрации
```

### Документация (3 новых файла)

```
MANA_SYSTEM.md       - Полная документация API (190+ строк)
MANA_BAR_UI.md       - Визуальный дизайн UI (90+ строк)
MANA_QUICK_START.md  - Быстрый старт с примерами (260+ строк)
```

## Как Использовать / How to Use

### Простой Пример

```java
import com.example.examplemod.mana.ManaHelper;

// Проверить и использовать ману
if (ManaHelper.consumeMana(player, 30.0f)) {
    // Использовать способность
}
```

### Создание Кастомной Системы

```java
import com.example.examplemod.mana.ManaDataBuilder;

ManaData mana = ManaDataBuilder.create()
    .setMaxMana(200.0f)          // Максимум маны
    .setRegenRate(0.3f)          // Скорость регенерации
    .setColor(0xFF8B00FF)        // Цвет (фиолетовый)
    .build();
```

## Технические Детали

### Параметры по умолчанию
- Максимальная мана: 100
- Регенерация: 0.1 за тик (2 в секунду)
- Цвет: Синий (#00A0FF)

### Манабар UI
- Размер: 80x8 пикселей
- Позиция: 10px от правого края, 50px от верха
- Бордюр: Белый, 1px
- Автоматическая адаптация к разрешению

### События
- `PlayerTickEvent.Post` - Регенерация маны
- `PlayerEvent.Clone` - Сохранение маны при респауне
- `PlayerEvent.PlayerLoggedInEvent` - Синхронизация при входе

## Архитектура

```
Player
  ↓
ModAttachments.PLAYER_MANA (Data Attachment)
  ↓
ManaData (IManaData)
  ↓
ManaHelper ← Ваш код использует это
  ↑
ManaEvents (Server) → SyncManaDataPacket → ManaBarOverlay (Client UI)
```

## Примеры Использования

### 1. Предмет с затратой маны
```java
if (ManaHelper.consumeMana(player, 25.0f)) {
    // Использовать магию
}
```

### 2. Изменение максимальной маны
```java
IManaData mana = player.getData(ModAttachments.PLAYER_MANA);
mana.setMaxMana(150.0f);
```

### 3. Изменение цвета манабара
```java
mana.setColor(0xFFFF0000); // Красный для огненной магии
```

## Тестирование

### Команды
```
/mana get              - Показать текущую ману
/mana set 50           - Установить ману на 50
/mana add 25           - Добавить 25 маны
/mana setmax 200       - Установить максимум на 200
```

### Тестовый предмет
```
/give @s examplemod:mana_test_item
```
Использует 20 маны при клике правой кнопкой.

## Преимущества Реализации

✅ **Гибкость**: Builder паттерн позволяет легко настраивать систему  
✅ **Расширяемость**: Интерфейсный дизайн позволяет создавать свои реализации  
✅ **Удобство**: ManaHelper упрощает работу с API  
✅ **Адаптивность**: UI автоматически подстраивается под разрешение  
✅ **Персонализация**: Настраиваемые цвета для разных типов магии  
✅ **Надежность**: Автоматическая синхронизация и сохранение  

## Заключение

Полностью реализована система маны как **конструктор** (не готовое решение), которая позволяет:
- Создавать кастомные системы маны через Builder
- Автоматически синхронизировать данные между сервером и клиентом
- Отображать красивый адаптивный манабар справа экрана
- Легко интегрировать в любые моды и системы способностей

Система полностью документирована с примерами кода и готова к использованию!
